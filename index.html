<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>DETAILGUY317 Garage</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8R4B3JWJ5V"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-8R4B3JWJ5V');
</script>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial;
  color:#f3f6fb;
  background:#060b14;
  overflow-x:hidden;
  padding-top:98px;
}

.ticker-container{
  position:fixed;
  top:0;left:0;right:0;
  height:60px;
  background:rgba(10,10,10,0.95);
  border-bottom:2px solid #ff6600;
  display:flex;
  align-items:center;
  z-index:100010;
  opacity:0;
  animation:fadeInTicker 2s ease-in-out 10s forwards;
}
@keyframes fadeInTicker{
  from{opacity:0;}
  to{opacity:1;}
}
.ticker-wrapper{
  flex:1;
  height:60px;
}
.ticker-wrapper iframe{
  width:100%;
  height:60px;
  border:none;
}
.ticker-btn{
  padding:10px 18px;
  margin:0 12px;
  background:#ff6600;
  border:none;
  border-radius:8px;
  color:#fff;
  font-weight:600;
  font-size:14px;
  cursor:pointer;
  white-space:nowrap;
  transition:.3s;
  box-shadow:0 0 15px rgba(255,102,0,0.4);
}
.ticker-btn:hover{
  background:#ff7f2a;
  box-shadow:0 0 20px rgba(255,102,0,0.7);
  transform:scale(1.05);
}

.auto-news-ticker {
  position:fixed;
  top:60px; left:0; right:0;
  width:100%;
  background:rgba(10,10,10,0.95);
  border-bottom:2px solid #ff6600;
  font-size:16px;
  font-weight:600;
  color:#ffe6cc;
  height:38px;
  display:flex; align-items:center; overflow:hidden;
  z-index:100009;
  opacity:0;
  animation:fadeInTicker 2s ease-in-out 10s forwards;
}
.auto-ticker-inner {
  white-space:nowrap;
  will-change:transform;
  animation:autoNewsScroll 120s linear infinite;
  display:inline-block;
  padding-left:100%;
}
@keyframes autoNewsScroll {
  0%   { transform: translateX(0);}
  100% { transform: translateX(-75%);}
}

#background{
  position:fixed;inset:0;
  background:url("./webback.jpg") center/cover no-repeat;
  filter:brightness(1.15) contrast(1.05);
  animation:scrollBg 12s ease-out forwards;
  z-index:0;
}
@keyframes scrollBg{
  from{background-position:center 200px;}
  to{background-position:center -180px;}
}

.overlay{
  position:fixed;top:98px;left:50%;
  transform:translateX(-50%);
  text-align:center;z-index:3;
  perspective:800px;
}
.overlay h1{
  font-size:64px;font-weight:800;
  color:#ff6a00;letter-spacing:4px;
  text-shadow:0 0 30px rgba(255,106,0,1);
  transform:rotateX(5deg) translateZ(60px) scale(1.1);
  animation:pulse3DStop 21s ease-in-out 1;
  animation-fill-mode:forwards;
}
.overlay p{
  margin-top:8px;font-size:24px;
  color:#ffe6cc;text-shadow:0 0 12px rgba(255,106,0,0.9);
  transform:rotateX(5deg) translateZ(25px) scale(1.05);
  animation:pulse3DSoftStop 21s ease-in-out 1;
  animation-fill-mode:forwards;
}
@keyframes pulse3D{
  0%,100%{transform:rotateX(15deg) translateZ(30px) scale(1);}
  50%{transform:rotateX(5deg) translateZ(60px) scale(1.1);}
}
@keyframes pulse3DSoft{
  0%,100%{transform:rotateX(10deg) translateZ(10px) scale(1);}
  50%{transform:rotateX(5deg) translateZ(25px) scale(1.05);}
}
@keyframes pulse3DStop{
  0%{transform:rotateX(15deg) translateZ(30px) scale(1);}
  14.29%{transform:rotateX(5deg) translateZ(60px) scale(1.1);}
  28.57%{transform:rotateX(15deg) translateZ(30px) scale(1);}
  42.86%{transform:rotateX(5deg) translateZ(60px) scale(1.1);}
  57.14%{transform:rotateX(15deg) translateZ(30px) scale(1);}
  71.43%{transform:rotateX(5deg) translateZ(60px) scale(1.1);}
  85.71%{transform:rotateX(15deg) translateZ(30px) scale(1);}
  100%{transform:rotateX(5deg) translateZ(60px) scale(1.1);}
}
@keyframes pulse3DSoftStop{
  0%{transform:rotateX(10deg) translateZ(10px) scale(1);}
  14.29%{transform:rotateX(5deg) translateZ(25px) scale(1.05);}
  28.57%{transform:rotateX(10deg) translateZ(10px) scale(1);}
  42.86%{transform:rotateX(5deg) translateZ(25px) scale(1.05);}
  57.14%{transform:rotateX(10deg) translateZ(10px) scale(1);}
  71.43%{transform:rotateX(5deg) translateZ(25px) scale(1.05);}
  85.71%{transform:rotateX(10deg) translateZ(10px) scale(1);}
  100%{transform:rotateX(5deg) translateZ(25px) scale(1.05);}
}

.icon-row{
  position:fixed;
  bottom:0;left:50%;
  transform:translateX(-50%);
  display:flex;gap:1.5rem;
  z-index:2;padding-bottom:12px;
}
.icon{
  min-width:130px;height:58px;
  background:linear-gradient(145deg,#ff6a00,#ff3b00);
  border-radius:40px;
  box-shadow:0 0 15px rgba(255,102,0,0.5);
  display:flex;align-items:center;justify-content:center;
  color:#fff;font-weight:600;letter-spacing:1px;
  cursor:pointer;transition:all .35s ease;
}
.icon:hover{
  transform:translateY(-8px) scale(1.05);
  box-shadow:0 0 25px #ff6600,0 0 40px rgba(255,102,0,0.5);
}

.search-bar{
  position:fixed;right:40px;bottom:40px;
  width:320px;
  background:rgba(20,20,20,0.95);
  color:#fff;border:1px solid #ff6600;
  border-radius:14px;padding:14px 18px;
  box-shadow:0 0 25px rgba(255,102,0,0.3);
  z-index:4;
}

.vin-box{
  position:fixed;left:40px;bottom:40px;
  width:360px;
  background:rgba(20,20,20,0.95);
  color:#fff;border:1px solid #ff6600;
  border-radius:14px;padding:14px 18px;
  box-shadow:0 0 25px rgba(255,102,0,0.3);
  z-index:4;
}

.search-bar label{
  font-weight:600;font-size:1.05em;
  color:#ff7f2a;margin-bottom:9px;
  text-align:center;display:block;
}
.vin-box label{
  font-weight:600;font-size:1.05em;
  color:#ff7f2a;margin-bottom:9px;
  text-align:center;display:block;
}

.search-bar input, .vin-box input{
  width:100%;padding:10px;
  border-radius:8px;background:#111;color:#fff;
  border:1px solid #555;margin-bottom:8px;outline:none;
}
.vin-box input{text-transform:uppercase;}

.search-bar button, .vin-box button{
  width:100%;padding:10px;border-radius:8px;
  border:none;background:#ff6600;color:#fff;
  cursor:pointer;font-size:1.05em;font-weight:600;
  transition:.3s;
}
.search-bar button:hover, .vin-box button:hover{
  background:#ff7f2a;
  box-shadow:0 0 20px rgba(255,102,0,0.6);
}

.scan-vin-btn{
  display:none;
  width:100%;
  padding:12px;
  margin-bottom:8px;
  border-radius:8px;
  border:none;
  background:#4ade80;
  color:#000;
  font-weight:600;
  font-size:1em;
  cursor:pointer;
  transition:.3s;
}
.scan-vin-btn:hover{
  background:#5ef590;
  box-shadow:0 0 20px rgba(74,222,128,0.6);
}

.camera-input{
  display:none;
}

.scan-status{
  background:#1a1a1a;
  color:#4ade80;
  padding:10px;
  border-radius:6px;
  font-size:.9em;
  text-align:center;
  margin-bottom:8px;
  display:none;
}

.faq-response{
  margin-top:12px;padding:12px;
  border-radius:8px;
  background:rgba(30,30,30,0.92);
  color:#ffe6cc;font-size:.95em;
  border:1px solid #ff6600;
  min-height:50px;
  text-align:center;
}

.vin-response{
  margin-top:12px;padding:12px;
  border-radius:8px;
  background:rgba(30,30,30,0.92);
  color:#ffe6cc;font-size:.92em;
  border:1px solid #ff6600;
  max-height:600px;
  overflow-y:auto;
  position:relative;
  transition: all 0.3s ease;
}

.vin-response.collapsed{
  max-height:50px;
  overflow:hidden;
  cursor:pointer;
}

.vin-response h3{
  color:#ff7f2a;
  font-size:1.1em;
  margin-bottom:10px;
  text-align:center;
  padding-right:25px;
}

.vehicle-info{
  padding:10px;
  margin:8px 0;
  background:rgba(255,102,0,0.1);
  border-radius:6px;
  line-height:1.8;
}

.button-row{
  display:flex;
  gap:8px;
  margin-top:10px;
}

.button-row button{
  flex:1;
  padding:10px;
  border-radius:6px;
  border:none;
  background:#ff6600;
  color:#fff;
  cursor:pointer;
  font-size:.9em;
  font-weight:600;
  transition:.3s;
}

.button-row button:hover{
  background:#ff7f2a;
  box-shadow:0 0 15px rgba(255,102,0,0.5);
}

.vin-close-btn{
  position:absolute;
  top:12px;
  right:12px;
  width:24px;
  height:24px;
  background:#ff6600;
  color:#fff;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  font-size:14px;
  font-weight:bold;
  transition:.3s;
  z-index:10;
}

.vin-close-btn:hover{
  background:#ff7f2a;
  transform:scale(1.1);
}

.camera-permission-modal{
  display:none;
  position:fixed;
  top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,0.85);
  z-index:100000;
  align-items:center;
  justify-content:center;
}

.camera-permission-modal.show{
  display:flex;
}

.permission-content{
  background:#1a1a1a;
  border:2px solid #ff6600;
  border-radius:12px;
  padding:30px;
  max-width:400px;
  text-align:center;
  box-shadow:0 0 30px rgba(255,102,0,0.5);
}

.permission-content h3{
  color:#ff7f2a;
  font-size:1.3em;
  margin-bottom:15px;
}

.permission-content p{
  color:#fff;
  margin-bottom:20px;
  line-height:1.6;
}

.permission-buttons{
  display:flex;
  gap:12px;
  justify-content:center;
}

.permission-buttons button{
  padding:12px 24px;
  border-radius:8px;
  border:none;
  font-weight:600;
  cursor:pointer;
  transition:.3s;
}

.permission-accept{
  background:#4ade80;
  color:#000;
}

.permission-accept:hover{
  background:#5ef590;
  box-shadow:0 0 15px rgba(74,222,128,0.5);
}

.permission-deny{
  background:#555;
  color:#fff;
}

.permission-deny:hover{
  background:#666;
}

/* STOCK MODAL & CHART STYLES */
.stock-modal-overlay{
  position:fixed;
  top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,0.7);
  z-index:99998;
  display:none;
}

.stock-modal-overlay.active{
  display:block;
}

.stock-modal{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  width:90%;
  max-width:800px;
  max-height:85vh;
  background:rgba(20,20,20,0.98);
  border:2px solid #ff6600;
  border-radius:16px;
  box-shadow:0 0 40px rgba(255,102,0,0.6);
  padding:20px;
  z-index:99999;
  display:none;
  overflow-y:auto;
}

.stock-modal.active{
  display:block;
}

.stock-modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
  padding-bottom:15px;
  border-bottom:2px solid #ff6600;
}

.stock-modal-header h2{
  color:#ff7f2a;
  font-size:1.8em;
}

.stock-modal-close{
  background:#ff6600;
  border:none;
  color:#fff;
  font-size:24px;
  width:36px;
  height:36px;
  border-radius:50%;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:.3s;
}

.stock-modal-close:hover{
  background:#ff7f2a;
  transform:scale(1.1);
}

.stock-search-container{
  margin-bottom:20px;
}

.stock-search-input{
  width:100%;
  padding:12px;
  background:#111;
  border:1px solid #555;
  border-radius:8px;
  color:#fff;
  font-size:1em;
  outline:none;
}

.stock-search-input:focus{
  border-color:#ff6600;
}

.stock-categories{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(180px, 1fr));
  gap:15px;
  margin-bottom:25px;
}

.stock-category{
  background:rgba(255,102,0,0.1);
  border:1px solid #ff6600;
  border-radius:10px;
  padding:15px;
  cursor:pointer;
  transition:.3s;
  text-align:center;
}

.stock-category:hover{
  background:rgba(255,102,0,0.2);
  transform:translateY(-3px);
  box-shadow:0 5px 15px rgba(255,102,0,0.3);
}

.stock-category h3{
  color:#ff7f2a;
  font-size:1.1em;
  margin-bottom:8px;
}

.stock-list{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(150px, 1fr));
  gap:10px;
}

.stock-item{
  background:#1a1a1a;
  border:1px solid #444;
  border-radius:8px;
  padding:12px;
  cursor:pointer;
  transition:.3s;
  text-align:center;
}

.stock-item:hover{
  background:#252525;
  border-color:#ff6600;
  transform:scale(1.05);
}

.stock-item.selected{
  background:rgba(255,102,0,0.2);
  border-color:#ff6600;
}

.stock-symbol{
  color:#ff7f2a;
  font-weight:700;
  font-size:1.1em;
  margin-bottom:4px;
}

.stock-name{
  color:#aaa;
  font-size:0.85em;
}

/* CHART CONTAINERS */
.search-chart-container{
  position:fixed;
  top:120px;
  right:20px;
  width:600px;
  height:500px;
  background:rgba(20,20,20,0.98);
  border:2px solid #ff6600;
  border-radius:12px;
  box-shadow:0 0 30px rgba(255,102,0,0.4);
  z-index:50000;
  display:none;
  overflow:hidden;
}

.search-chart-container.active{
  display:block;
}

.search-chart-header{
  background:#1a1a1a;
  padding:10px 15px;
  border-bottom:2px solid #ff6600;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.search-chart-title{
  color:#ff7f2a;
  font-weight:700;
  font-size:1.1em;
}

.search-chart-close{
  background:#ff6600;
  border:none;
  color:#fff;
  width:28px;
  height:28px;
  border-radius:50%;
  cursor:pointer;
  font-size:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:.3s;
}

.search-chart-close:hover{
  background:#ff7f2a;
  transform:scale(1.1);
}

.left-charts-container{
  position:fixed;
  top:120px;
  left:20px;
  width:550px;
  display:flex;
  flex-direction:column;
  gap:20px;
  z-index:50000;
}

.left-chart-box{
  width:100%;
  height:380px;
  background:rgba(20,20,20,0.98);
  border:2px solid #ff6600;
  border-radius:12px;
  box-shadow:0 0 30px rgba(255,102,0,0.4);
  display:none;
  overflow:hidden;
}

.left-chart-box.active{
  display:block;
}

.left-chart-header{
  background:#1a1a1a;
  padding:10px 15px;
  border-bottom:2px solid #ff6600;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.left-chart-title{
  color:#ff7f2a;
  font-weight:700;
  font-size:1.1em;
}

.left-chart-close{
  background:#ff6600;
  border:none;
  color:#fff;
  width:28px;
  height:28px;
  border-radius:50%;
  cursor:pointer;
  font-size:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:.3s;
}

.left-chart-close:hover{
  background:#ff7f2a;
  transform:scale(1.1);
}

</style>
</head>
<body>

<div class="ticker-container">
  <div class="ticker-wrapper">
    <iframe src="https://s.tradingview.com/embed-widget/ticker-tape/?locale=en#%7B%22symbols%22%3A%5B%7B%22description%22%3A%22S%26P%20500%22%2C%22proName%22%3A%22FOREXCOM%3ASPXUSD%22%7D%2C%7B%22description%22%3A%22NASDAQ%22%2C%22proName%22%3A%22NASDAQ%3ANDX%22%7D%2C%7B%22description%22%3A%22DOW%22%2C%22proName%22%3A%22DJ%3ADJI%22%7D%2C%7B%22description%22%3A%22Tesla%22%2C%22proName%22%3A%22NASDAQ%3ATSLA%22%7D%2C%7B%22description%22%3A%22Apple%22%2C%22proName%22%3A%22NASDAQ%3AAAPL%22%7D%2C%7B%22description%22%3A%22Amazon%22%2C%22proName%22%3A%22NASDAQ%3AAMZN%22%7D%2C%7B%22description%22%3A%22NVIDIA%22%2C%22proName%22%3A%22NASDAQ%3ANVDA%22%7D%2C%7B%22description%22%3A%22Bitcoin%22%2C%22proName%22%3A%22COINBASE%3ABTCUSD%22%7D%2C%7B%22description%22%3A%22Ethereum%22%2C%22proName%22%3A%22COINBASE%3AETHUSD%22%7D%5D%2C%22showSymbolLogo%22%3Atrue%2C%22isTransparent%22%3Atrue%2C%22displayMode%22%3A%22adaptive%22%2C%22colorTheme%22%3A%22dark%22%2C%22width%22%3A%22100%25%22%2C%22height%22%3A60%7D" frameborder="0"></iframe>
  </div>
  <button class="ticker-btn" onclick="toggleStockModal()">VIEW STOCKS</button>
</div>

<div class="auto-news-ticker">
  <div class="auto-ticker-inner" id="autoTickerInner">
    üì∞ Loading market news...
  </div>
</div>

<!-- Stock Modal Overlay -->
<div class="stock-modal-overlay" id="stockModalOverlay" onclick="closeStockModal()"></div>

<!-- Stock Modal -->
<div class="stock-modal" id="stockModal">
  <div class="stock-modal-header">
    <h2>üìà Stock Watchlist</h2>
    <button class="stock-modal-close" onclick="closeStockModal()">√ó</button>
  </div>
  
  <div class="stock-search-container">
    <input type="text" class="stock-search-input" id="stockSearchInput" placeholder="Search stocks by symbol or name..." oninput="filterStocks()">
  </div>
  
  <div class="stock-categories">
    <div class="stock-category" onclick="showCategory('tech')">
      <h3>üíª Tech Giants</h3>
      <p style="font-size:0.85em;color:#aaa">FAANG+</p>
    </div>
    <div class="stock-category" onclick="showCategory('ev')">
      <h3>üöó EV & Auto</h3>
      <p style="font-size:0.85em;color:#aaa">Electric Vehicles</p>
    </div>
    <div class="stock-category" onclick="showCategory('finance')">
      <h3>üí∞ Finance</h3>
      <p style="font-size:0.85em;color:#aaa">Banks & FinTech</p>
    </div>
    <div class="stock-category" onclick="showCategory('crypto')">
      <h3>‚Çø Crypto</h3>
      <p style="font-size:0.85em;color:#aaa">Digital Assets</p>
    </div>
    <div class="stock-category" onclick="showCategory('all')">
      <h3>üìä All Stocks</h3>
      <p style="font-size:0.85em;color:#aaa">Full List</p>
    </div>
  </div>
  
  <div id="stockListContainer"></div>
</div>

<!-- Search Chart Container (from search bar) -->
<div class="search-chart-container" id="searchChartContainer">
  <div class="search-chart-header">
    <span class="search-chart-title" id="searchChartTitle">Chart</span>
    <button class="search-chart-close" onclick="closeSearchChart()">√ó</button>
  </div>
  <div id="searchChartWidget"></div>
</div>

<!-- Left Side Chart Boxes -->
<div class="left-charts-container">
  <div class="left-chart-box" id="leftChart1">
    <div class="left-chart-header">
      <span class="left-chart-title" id="leftChart1Title">Chart 1</span>
      <button class="left-chart-close" onclick="closeLeftChart(1)">√ó</button>
    </div>
    <div id="leftChart1Widget"></div>
  </div>
  
  <div class="left-chart-box" id="leftChart2">
    <div class="left-chart-header">
      <span class="left-chart-title" id="leftChart2Title">Chart 2</span>
      <button class="left-chart-close" onclick="closeLeftChart(2)">√ó</button>
    </div>
    <div id="leftChart2Widget"></div>
  </div>
</div>

<div id="background"></div>

<div class="overlay">
  <h1>DETAILGUY317</h1>
  <p>Your Premium Garage Experience</p>
</div>

<div class="icon-row">
  <div class="icon" onclick="alert('Scheduling feature coming soon!')">SCHEDULE</div>
  <div class="icon" onclick="alert('Contact feature coming soon!')">CONTACT</div>
  <div class="icon" onclick="alert('Gallery feature coming soon!')">GALLERY</div>
</div>

<div class="search-bar">
  <label>FAQ & CODES</label>
  <input id="queryInput" placeholder="Ask a question or enter code...">
  <button onclick="handleSearch()">SEARCH</button>
  <div id="faq-response" class="faq-response">Welcome! Enter a question or code above.</div>
</div>

<div class="vin-box">
  <label>VIN DECODER</label>
  <button class="scan-vin-btn" id="scanVINBtn" onclick="triggerVINScan()">üì∏ Scan VIN with Camera</button>
  <div class="scan-status" id="scanStatus"></div>
  <input type="file" accept="image/*" capture="environment" class="camera-input" id="cameraInput" onchange="processVINImage(event)">
  <input id="vinInput" placeholder="Enter 17-digit VIN..." maxlength="17">
  <button onclick="handleVIN()">DECODE VIN</button>
  <div id="vin-response" class="vin-response">Enter a VIN above to decode vehicle information.</div>
</div>

<div class="camera-permission-modal" id="cameraPermissionModal">
  <div class="permission-content">
    <h3>üì∏ Camera Access</h3>
    <p>This app needs camera access to scan your vehicle's VIN sticker. Your photos are processed locally and never stored or uploaded.</p>
    <div class="permission-buttons">
      <button class="permission-accept" onclick="acceptCameraPermission()">Allow Camera</button>
      <button class="permission-deny" onclick="denyCameraPermission()">Cancel</button>
    </div>
  </div>
</div>

<script>
// STOCK DATA
const stockData = {
  tech: [
    {symbol: 'AAPL', name: 'Apple'},
    {symbol: 'MSFT', name: 'Microsoft'},
    {symbol: 'GOOGL', name: 'Google'},
    {symbol: 'META', name: 'Meta'},
    {symbol: 'AMZN', name: 'Amazon'},
    {symbol: 'NVDA', name: 'NVIDIA'},
    {symbol: 'NFLX', name: 'Netflix'},
    {symbol: 'TSLA', name: 'Tesla'}
  ],
  ev: [
    {symbol: 'TSLA', name: 'Tesla'},
    {symbol: 'RIVN', name: 'Rivian'},
    {symbol: 'LCID', name: 'Lucid'},
    {symbol: 'F', name: 'Ford'},
    {symbol: 'GM', name: 'General Motors'},
    {symbol: 'NIO', name: 'NIO'}
  ],
  finance: [
    {symbol: 'JPM', name: 'JPMorgan'},
    {symbol: 'BAC', name: 'Bank of America'},
    {symbol: 'WFC', name: 'Wells Fargo'},
    {symbol: 'GS', name: 'Goldman Sachs'},
    {symbol: 'MS', name: 'Morgan Stanley'},
    {symbol: 'V', name: 'Visa'},
    {symbol: 'MA', name: 'Mastercard'},
    {symbol: 'PYPL', name: 'PayPal'}
  ],
  crypto: [
    {symbol: 'BTCUSD', name: 'Bitcoin'},
    {symbol: 'ETHUSD', name: 'Ethereum'},
    {symbol: 'COINBASE:SOLUSD', name: 'Solana'},
    {symbol: 'COINBASE:ADAUSD', name: 'Cardano'}
  ]
};

let allStocks = [];
Object.values(stockData).forEach(category => {
  category.forEach(stock => {
    if(!allStocks.find(s => s.symbol === stock.symbol)){
      allStocks.push(stock);
    }
  });
});

let selectedStocks = [];
let leftChartSlots = [null, null];

// STOCK MODAL FUNCTIONS
function toggleStockModal(){
  const overlay = document.getElementById('stockModalOverlay');
  const modal = document.getElementById('stockModal');
  
  if(modal.classList.contains('active')){
    closeStockModal();
  } else {
    overlay.classList.add('active');
    modal.classList.add('active');
    showCategory('all');
  }
}

function closeStockModal(){
  const overlay = document.getElementById('stockModalOverlay');
  const modal = document.getElementById('stockModal');
  overlay.classList.remove('active');
  modal.classList.remove('active');
}

function showCategory(category){
  const container = document.getElementById('stockListContainer');
  const stocks = category === 'all' ? allStocks : (stockData[category] || []);
  
  let html = '<div class="stock-list">';
  stocks.forEach(stock => {
    const isSelected = selectedStocks.includes(stock.symbol);
    html += `
      <div class="stock-item ${isSelected ? 'selected' : ''}" onclick="selectStock('${stock.symbol}', '${stock.name}')">
        <div class="stock-symbol">${stock.symbol}</div>
        <div class="stock-name">${stock.name}</div>
      </div>
    `;
  });
  html += '</div>';
  
  container.innerHTML = html;
}

function filterStocks(){
  const searchTerm = document.getElementById('stockSearchInput').value.toLowerCase();
  const container = document.getElementById('stockListContainer');
  
  const filtered = allStocks.filter(stock => 
    stock.symbol.toLowerCase().includes(searchTerm) || 
    stock.name.toLowerCase().includes(searchTerm)
  );
  
  let html = '<div class="stock-list">';
  filtered.forEach(stock => {
    const isSelected = selectedStocks.includes(stock.symbol);
    html += `
      <div class="stock-item ${isSelected ? 'selected' : ''}" onclick="selectStock('${stock.symbol}', '${stock.name}')">
        <div class="stock-symbol">${stock.symbol}</div>
        <div class="stock-name">${stock.name}</div>
      </div>
    `;
  });
  html += '</div>';
  
  container.innerHTML = html;
}

function selectStock(symbol, name){
  // Find next available left chart slot
  let slotIndex = leftChartSlots.indexOf(null);
  
  if(slotIndex === -1){
    alert('Maximum 2 charts displayed. Close a chart to add another.');
    return;
  }
  
  leftChartSlots[slotIndex] = symbol;
  
  // Show the chart
  const chartBox = document.getElementById(`leftChart${slotIndex + 1}`);
  const titleEl = document.getElementById(`leftChart${slotIndex + 1}Title`);
  const widgetEl = document.getElementById(`leftChart${slotIndex + 1}Widget`);
  
  chartBox.classList.add('active');
  titleEl.textContent = `${symbol} - ${name}`;
  
  // Create TradingView widget
  loadTradingViewChart(widgetEl, symbol);
  
  // Add to selected stocks
  if(!selectedStocks.includes(symbol)){
    selectedStocks.push(symbol);
  }
  
  // Update UI
  showCategory('all');
}

function closeLeftChart(chartNum){
  const chartBox = document.getElementById(`leftChart${chartNum}`);
  const widgetEl = document.getElementById(`leftChart${chartNum}Widget`);
  
  chartBox.classList.remove('active');
  widgetEl.innerHTML = '';
  
  const symbol = leftChartSlots[chartNum - 1];
  leftChartSlots[chartNum - 1] = null;
  
  // Remove from selected stocks if not in other slot
  if(!leftChartSlots.includes(symbol)){
    const index = selectedStocks.indexOf(symbol);
    if(index > -1){
      selectedStocks.splice(index, 1);
    }
  }
  
  showCategory('all');
}

function loadSearchChart(symbol, name){
  const container = document.getElementById('searchChartContainer');
  const title = document.getElementById('searchChartTitle');
  const widget = document.getElementById('searchChartWidget');
  
  container.classList.add('active');
  title.textContent = `${symbol} - ${name}`;
  
  loadTradingViewChart(widget, symbol);
}

function closeSearchChart(){
  const container = document.getElementById('searchChartContainer');
  const widget = document.getElementById('searchChartWidget');
  
  container.classList.remove('active');
  widget.innerHTML = '';
}

function loadTradingViewChart(container, symbol){
  container.innerHTML = '';
  
  // Determine the exchange prefix if needed
  let chartSymbol = symbol;
  if(symbol === 'BTCUSD' || symbol === 'ETHUSD'){
    chartSymbol = 'COINBASE:' + symbol;
  } else if(symbol.includes(':')){
    chartSymbol = symbol;
  } else {
    chartSymbol = 'NASDAQ:' + symbol;
  }
  
  const script = document.createElement('script');
  script.type = 'text/javascript';
  script.src = 'https://s3.tradingview.com/tv.js';
  script.async = true;
  script.onload = function(){
    new TradingView.widget({
      "autosize": true,
      "symbol": chartSymbol,
      "interval": "D",
      "timezone": "Etc/UTC",
      "theme": "dark",
      "style": "1",
      "locale": "en",
      "toolbar_bg": "#1a1a1a",
      "enable_publishing": false,
      "hide_side_toolbar": false,
      "allow_symbol_change": true,
      "details": true,
      "hotlist": true,
      "calendar": true,
      "studies": [
        "STD;SMA"
      ],
      "container_id": container.id || container.parentElement.id
    });
  };
  document.head.appendChild(script);
}

// Allow clicking background to close modal but keep charts
document.getElementById('background').addEventListener('click', function(){
  closeStockModal();
});

// FAQ SEARCH
function handleSearch(){
  const query=document.getElementById('queryInput').value.trim().toUpperCase();
  const response=document.getElementById('faq-response');
  
  if(!query){
    response.textContent="Please enter a question or stock symbol!";
    return;
  }
  
  // Check if it's a stock symbol
  const stock = allStocks.find(s => s.symbol.toUpperCase() === query);
  
  if(stock){
    response.textContent=`Loading chart for ${stock.name} (${stock.symbol})...`;
    loadSearchChart(stock.symbol, stock.name);
  } else {
    response.textContent="You asked: "+query+" (Demo response ‚Äî AI integration coming soon)";
  }
}

// Allow Enter key in search
document.getElementById('queryInput').addEventListener('keypress', function(e){
  if(e.key === 'Enter'){
    handleSearch();
  }
});

// VIN SCANNING FUNCTIONS
function triggerVINScan(){
  document.getElementById('cameraPermissionModal').classList.add('show');
}

function acceptCameraPermission(){
  document.getElementById('cameraPermissionModal').classList.remove('show');
  document.getElementById('cameraInput').click();
}

function denyCameraPermission(){
  document.getElementById('cameraPermissionModal').classList.remove('show');
  alert('Camera access denied. You can manually enter your VIN instead.');
}

function processVINImage(event){
  const file = event.target.files[0];
  if(!file) return;
  
  const scanStatus = document.getElementById('scanStatus');
  scanStatus.style.display = 'block';
  scanStatus.textContent = 'üì∏ Processing image...';
  scanStatus.style.color = '#4ade80';
  
  Tesseract.recognize(
    file,
    'eng',
    {
      logger: info => {
        if(info.status === 'recognizing text'){
          scanStatus.textContent = 'üîç Scanning VIN... ' + Math.round(info.progress * 100) + '%';
        }
      }
    }
  ).then(({ data: { text } }) => {
    const vinMatch = text.match(/[A-HJ-NPR-Z0-9]{17}/);
    
    if(vinMatch){
      const detectedVIN = vinMatch[0];
      document.getElementById('vinInput').value = detectedVIN;
      scanStatus.textContent = '‚úÖ VIN detected: ' + detectedVIN;
      scanStatus.style.color = '#4ade80';
      
      setTimeout(() => {
        scanStatus.style.display = 'none';
      }, 3000);
    } else {
      scanStatus.textContent = '‚ùå No VIN found. Try again with better lighting or enter manually.';
      scanStatus.style.color = '#fbbf24';
      setTimeout(() => {
        scanStatus.style.display = 'none';
      }, 5000);
    }
  }).catch(err => {
    scanStatus.textContent = '‚ùå Scan failed. Please enter VIN manually.';
    scanStatus.style.color = '#ef4444';
    console.error('VIN scan error:', err);
    setTimeout(() => {
      scanStatus.style.display = 'none';
    }, 5000);
  });
  
  event.target.value = '';
}

function handleVIN(){
  const vin=document.getElementById('vinInput').value.trim().toUpperCase();
  const response=document.getElementById('vin-response');

  if(!vin){
    response.innerHTML="<div style='text-align:center'>Please enter a VIN!</div>";
    return;
  }

  if(vin.length!==17){
    response.innerHTML="<div style='text-align:center'>VIN must be exactly 17 characters!</div>";
    return;
  }

  response.innerHTML="<div style='text-align:center'>üîç Decoding VIN...</div>";
  
  fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/DecodeVin/${vin}?format=json`)
    .then(res=>res.json())
    .then(vehicleData=>{
      const results = vehicleData.Results || [];
      let vehicleInfo = {};
      results.forEach(item => {
        if(item.Value && item.Value !== '' && item.Value !== 'Not Applicable'){
          vehicleInfo[item.Variable] = item.Value;
        }
      });
      displayResults(vin, vehicleInfo);
    })
    .catch(err=>{
      response.innerHTML="<div style='text-align:center;color:#ef4444'>Error connecting to NHTSA. Please try again.</div>";
    });
}

function displayResults(vin, vehicleInfo){
  const response=document.getElementById('vin-response');
  const wmi=vin.substring(0,3);
  
  let recallUrl='';
  let manufacturer='';

  if(wmi.startsWith('1F') || wmi.startsWith('3F')){
    recallUrl='https://owner.ford.com/tools/account/maintenance/recalls.html';
    manufacturer='Ford';
  }
  else if(wmi.startsWith('1G') || wmi.startsWith('3G') || wmi.startsWith('2G')){
    recallUrl='https://my.gm.com/recalls';
    manufacturer='GM';
  }
  else if(wmi.startsWith('1C') || wmi.startsWith('3C') || wmi.startsWith('2C')){
    recallUrl='https://recalls.mopar.com/';
    manufacturer='Chrysler/Stellantis';
  }
  else if(wmi.startsWith('4T') || wmi.startsWith('5T') || wmi.startsWith('JT')){
    recallUrl='https://www.toyota.com/recall';
    manufacturer='Toyota';
  }
  else if(wmi.startsWith('1H') || wmi.startsWith('2H') || wmi.startsWith('JH')){
    recallUrl='https://owners.honda.com/service-maintenance/recalls';
    manufacturer='Honda';
  }
  else if(wmi.startsWith('1N') || wmi.startsWith('3N') || wmi.startsWith('JN')){
    recallUrl='https://www.nissan-recalls.com/';
    manufacturer='Nissan';
  }
  else if(wmi.startsWith('KM') || wmi.startsWith('5N')){
    recallUrl='https://autoservice.hyundaiusa.com/campaignhome';
    manufacturer='Hyundai';
  }
  else if(wmi.startsWith('KN')){
    recallUrl='https://owners.kia.com/us/en/safety-recall.html';
    manufacturer='Kia';
  }
  else if(wmi.startsWith('4S') || wmi.startsWith('JF')){
    recallUrl='https://www.subaru.com/vehicle-recalls.html';
    manufacturer='Subaru';
  }
  else if(wmi.startsWith('JM')){
    recallUrl='https://www.mazdausa.com/owners/recalls';
    manufacturer='Mazda';
  }
  else if(wmi.startsWith('WV') || wmi.startsWith('3V')){
    recallUrl='https://www.vw.com/recalls/';
    manufacturer='Volkswagen';
  }
  else if(wmi.startsWith('WB') || wmi.startsWith('5U')){
    recallUrl='https://www.bmwusa.com/recall.html';
    manufacturer='BMW';
  }
  else if(wmi.startsWith('WD') || wmi.startsWith('4J')){
    recallUrl='https://www.mbusa.com/en/owners/recalls';
    manufacturer='Mercedes-Benz';
  }
  else{
    recallUrl='https://www.nhtsa.gov/recalls';
    manufacturer=vehicleInfo.Make || 'Unknown';
  }
  
  let html='<h3>üìã VIN: '+vin+'</h3>';
  
  html+='<div class="vehicle-info">';
  html+='<strong>üöó Vehicle Information</strong><br>';
  if(vehicleInfo.ModelYear) html+='<strong>Year:</strong> '+vehicleInfo.ModelYear+'<br>';
  if(vehicleInfo.Make) html+='<strong>Make:</strong> '+vehicleInfo.Make+'<br>';
  if(vehicleInfo.Model) html+='<strong>Model:</strong> '+vehicleInfo.Model+'<br>';
  if(vehicleInfo.Trim) html+='<strong>Trim:</strong> '+vehicleInfo.Trim+'<br>';
  if(vehicleInfo.BodyClass) html+='<strong>Body Type:</strong> '+vehicleInfo.BodyClass+'<br>';
  if(vehicleInfo.EngineModel) html+='<strong>Engine:</strong> '+vehicleInfo.EngineModel+'<br>';
  if(vehicleInfo.DisplacementL) html+='<strong>Displacement:</strong> '+vehicleInfo.DisplacementL+'L<br>';
  if(vehicleInfo.DriveType) html+='<strong>Drive Type:</strong> '+vehicleInfo.DriveType+'<br>';
  if(vehicleInfo.TransmissionStyle) html+='<strong>Transmission:</strong> '+vehicleInfo.TransmissionStyle+'<br>';
  html+='</div>';
  
  html+='<div style="margin-top:12px;padding:12px;background:#2a1a08;border:2px solid #fbbf24;border-radius:6px">';
  html+='<strong style="color:#fbbf24;font-size:1.05em">‚ö†Ô∏è CHECK FOR RECALLS:</strong><br>';
  html+='<span style="color:#fff;font-size:.92em;line-height:1.5">';
  html+='Click buttons below to check manufacturer & NHTSA sites for active recalls.';
  html+='</span>';
  html+='</div>';
  
  html+='<div class="button-row">';
  html+='<button onclick="copyVIN(\''+vin+'\')">üìã Copy VIN</button>';
  if(manufacturer!=='Unknown'){
    html+='<button onclick="goToOEM(\''+recallUrl+'\')">üè≠ '+manufacturer+'</button>';
  }
  html+='</div>';
  
  html+='<div class="button-row">';
  html+='<button onclick="goToCarfax(\''+vin+'\')">üìä CarFax</button>';
  html+='<button onclick="goToNHTSA(\''+vin+'\')">üîç NHTSA</button>';
  html+='</div>';
  
  html+='<div style="margin-top:8px;font-size:.7em;color:#888;text-align:center">Vehicle data from NHTSA</div>';
  
  response.innerHTML=html;
  
  navigator.clipboard.writeText(vin).then(()=>{
    console.log('VIN auto-copied');
  }).catch(()=>{
    console.log('Auto-copy failed');
  });
  
  const closeBtn = document.createElement('div');
  closeBtn.className = 'vin-close-btn';
  closeBtn.innerHTML = '‚úï';
  closeBtn.onclick = function(e){
    e.stopPropagation();
    toggleVINResults();
  };
  response.insertBefore(closeBtn, response.firstChild);
  
  response.onclick = function(){
    if(response.classList.contains('collapsed')){
      response.classList.remove('collapsed');
    }
  };
}

function toggleVINResults(){
  const response = document.getElementById('vin-response');
  response.classList.add('collapsed');
}

function copyVIN(vin){
  navigator.clipboard.writeText(vin).then(()=>{
    alert('‚úÖ VIN copied!\n\nPaste it on the manufacturer or NHTSA site to check for recalls.');
  }).catch(()=>{
    alert('VIN: '+vin+'\n\nPlease copy manually.');
  });
}

function goToOEM(url){
  window.open(url,'_blank');
}

function goToCarfax(vin){
  window.open('https://www.carfax.com/vehicle/'+vin,'_blank');
}

function goToNHTSA(vin){
  window.open('https://www.nhtsa.gov/recalls?vin='+vin,'_blank');
}

// NEWS TICKER AUTO-LOAD
fetch('https://api.rss2json.com/v1/api.json?rss_url=https://feeds.bloomberg.com/markets/news.rss')
  .then(res => res.json())
  .then(data => {
    if(data.items && data.items.length > 0){
      const newsItems = data.items.slice(0, 15).map(item => 
        `üì∞ ${item.title}`
      ).join('  ‚Ä¢  ');
      document.getElementById('autoTickerInner').textContent = newsItems + '  ‚Ä¢  ' + newsItems;
    }
  })
  .catch(() => {
    document.getElementById('autoTickerInner').textContent = 
      'üì∞ Market news temporarily unavailable  ‚Ä¢  Stay tuned for updates';
  });

// CAMERA DETECTION
if('mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices){
  document.getElementById('scanVINBtn').style.display = 'block';
}
</script>

</body>
</html>
